// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// ==========================================
// USER MODEL
// ==========================================
model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String   @unique
  password  String
  role      Role     @default(user)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  ownedProjects    Project[] @relation("ProjectOwner")
  memberProjects   Project[] @relation("ProjectMembers", fields: [memberProjectIds], references: [id])
  memberProjectIds String[]  @db.ObjectId
  
  assignedTasks    Task[]    @relation("TaskAssignee")
  createdTasks     Task[]    @relation("TaskCreator")

  @@map("users")
}

enum Role {
  user
  admin
}

// ==========================================
// PROJECT MODEL
// ==========================================
model Project {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  status      ProjectStatus @default(active)
  color       String        @default("#3B82F6")
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  owner     User     @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId   String   @db.ObjectId
  
  members   User[]   @relation("ProjectMembers", fields: [memberIds], references: [id])
  memberIds String[] @db.ObjectId
  
  tasks     Task[]

  @@map("projects")
}

enum ProjectStatus {
  active
  completed
  archived
}

// ==========================================
// TASK MODEL
// ==========================================
model Task {
  id           String       @id @default(auto()) @map("_id") @db.ObjectId
  title        String
  description  String?
  status       TaskStatus   @default(todo)
  priority     TaskPriority @default(medium)
  dueDate      DateTime?
  tags         String[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  // Relations
  project      Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId    String   @db.ObjectId
  
  assignedTo   User?    @relation("TaskAssignee", fields: [assignedToId], references: [id], onDelete: SetNull)
  assignedToId String?  @db.ObjectId
  
  createdBy    User     @relation("TaskCreator", fields: [createdById], references: [id], onDelete: Cascade)
  createdById  String   @db.ObjectId

  @@index([projectId, status])
  @@index([assignedToId])
  @@map("tasks")
}

enum TaskStatus {
  todo
  in_progress  @map("in-progress")
  completed
}

enum TaskPriority {
  low
  medium
  high
}